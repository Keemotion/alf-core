#!/usr/bin/env ruby
$LOAD_PATH.unshift File.expand_path('../../lib', __FILE__)
require "alf"

# 
# Generates a plot
#
# SYNOPSIS
#   #{program_name} #{command_name}
#
# OPTIONS
# #{summarized_options}
#
class Plot < Alf::Operator(__FILE__, __LINE__)
  include Alf::Operator::Shortcut

  # Install options
  options do |opt|
    @abscissa = :x
    opt.on('-x abscissa', "Specify abscissa attribute") do |value|
      @abscissa = value.to_sym
    end
    @ordinate = :y
    opt.on('-y ordinate', "Specify ordinate attribute") do |value|
      @ordinate = value.to_sym
    end
    @series = :series
    opt.on('-s series', "Specify series attribute") do |value|
      @series = value.to_sym
    end
    @title = :title
    opt.on('-t title', "Specify title attribute") do |value|
      @title = value.to_sym
    end
  end

  def longexpr
    (rename \
      (group \
        (group \
          (rename @input,
                  @abscissa => :x, @ordinate => :y, 
                  @series   => :title),
          :data => [:x, :y]),
        :datasets => [:title, :data]),
     @title => :title)
  end

end # class Plot
Plot.run(ARGV, __FILE__) if $0 == __FILE__
